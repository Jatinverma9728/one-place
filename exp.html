<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Picker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        #controls {
            padding: 20px;
        }
        #location-pin {
            font-size: 50px;
            cursor: pointer;
            color: #ff4757;
            animation: jump 1.5s infinite;
        }
        #location-display {
            margin-top: 10px;
            font-size: 16px;
            color: #333;
        }
        #loading {
            display: none;
            font-size: 16px;
            color: #555;
        }

        /* Subtle jump animation */
        @keyframes jump {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>

    <div id="controls">
        <div id="location-pin" title="Detect My Location"><img src="icons/gps.png"></div>
        <p id="location-display">No location selected yet.</p>
        <p id="loading">Fetching location...</p>
    </div>

    <script>
        let selectedLocation = null;

        const locationPin = document.getElementById('location-pin');
        const locationDisplay = document.getElementById('location-display');
        const loadingIndicator = document.getElementById('loading');

        locationPin.addEventListener('click', () => {
            loadingIndicator.style.display = 'block'; // Show loading text

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;
                    selectedLocation = { latitude, longitude };

                    const address = await reverseGeocode(latitude, longitude);
                    locationDisplay.textContent = ` ${address}`;
                    loadingIndicator.style.display = 'none'; // Hide loading text
                }, () => {
                    alert("Could not detect location. Please allow location access in your browser.");
                    loadingIndicator.style.display = 'none'; // Hide loading text
                });
            } else {
                alert("Geolocation is not supported by this browser.");
                loadingIndicator.style.display = 'none'; // Hide loading text
            }
        });

        async function reverseGeocode(lat, lon) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                return data.display_name || "Unknown Location";
            } catch {
                return "Unable to fetch address.";
            }
        }
    </script>

</body>
</html>
